{% extends "content_base_v2.html" %}
{% load apps_filter %}
{% block css %}
    <style>
    .tl.pl25 img{
    	height: 60px;
    	width: 60px;
    }
    </style>
{% endblock %}
{% block content-panel %}
<div class="xui-redEnvelopeParticipances-page xui-appPage-commonStyle">
	<div class="relative">
		<ul class="breadcrumb">
			<li>您当前所在位置</li>
            <li><a href="/apps/lottery/lotteries/">百宝箱</a></li>
            <li><a href="/apps/promotion/red_envelope_rule_list/">分享红包</a></li>
			<li class="active">查看结果</li>
		</ul>
	</div>
	<div class="xui-filterPanel pb10 mb15">
		<div class="xui-form disT">
			<div class="xui-col disTc">
				<div class="xui-i-item">
					<label class="">下单会员：</label>
					<input type="text" class="form-control" id="participant_name" name="participant_name" value="" />
				</div>
			</div>
			<div class="xui-col disTc">
				<div class="xui-i-item ml20">
					<label>会员状态：</label>
					<select class="" id="member_status" name="member_status">
						<option value="-1">所有会员</option>
						<option value="0">非会员</option>
						<option value="1">新会员</option>
						<option value="2">普通会员</option>
						<option value="3">铜牌会员</option>
						<option value="4">钻石会员</option>
					</select>
				</div>
			</div>
			<div class="xui-col disTc">
				<div class="xui-i-item ml20">
					<label>使用状态：</label>
					<select class="" id="red_envelope_status" name="red_envelope_status">
						<option value="-1">所有状态</option>
						<option value="0">未使用</option>
						<option value="1">已使用</option>
					</select>
				</div>
			</div>
		</div>
		<div class="xui-btn-group">
			<a class="btn btn-primary mr40 xa-search xui-fontBold" href="javascript:void(0);">查&nbsp;&nbsp;&nbsp;询</a>
			<a class="btn btn-default xa-reset xui-fontBold" href="javascript:void(0);">重&nbsp;&nbsp;&nbsp;置</a>
		</div>
	</div>
    <div class="panel panel-default xui-tableBox">
        <div
            class="panel-body panel-table p0 mt10"
            data-ui-role="advanced-table"
            data-app="apps/promotion"
            data-resource="red_envelope_participances"
            data-args='{"id": "{{red_envelope_id}}"}'
            data-template-id="#red_envelope_participances_view"
            data-enable-paginator="true"
            data-enable-sort="false"
            data-disable-header-select="true"
            data-item-count-per-page="10"
            id="redEnvelopeParticipancesList"
        ></div>
    </div>
</div>
{% endblock %}

{% block js %}
{% verbatim %}
<script id="red_envelope_participances_view" type="text/x-jquery-tmpl">
	{{if items!='' }}
	<table class="table table-bordered xb-stripedTable xb-noTdBorder xb-noBottom xb-noBorder xb-theadBg mb10">
		<thead>
			<tr>
				<th>下单会员</th>
				<th>会员状态</th>
				<th>引入领取人数</th>
				<th>引入使用人数</th>
				<th>引入新关注</th>
				<th>引入消费额</th>
				<th>领取时间</th>
				<th>使用状态</th>
				<th>操作</th>
			</tr>
		</thead>
		<tbody>
		  {{each(i, item) items}}
			<tr data-id="${item.id}">
				<td
					class="tl pl25"
					style="width:250px; height:60px;"
				>
					<img src="${item.participant_icon}" />
					{{html item.participant_name}}
				</td>
				<td>

				</td>
				<td>

				</td>
				<td>

				</td>
				<td>

				</td>
				<td>

				</td>
				<td>
					${item.created_at}
				</td>
				<td>

				</td>
				<td>

				</td>
			</tr>
			{{/each}}
		</tbody>
		<div class="cb"></div>
	</table>
	{{else}}
		<div class="xui-emptyBox m10">
			<img src="/static_v2/img/editor/empty.png">
			<span class="ml20">您还没有相关数据！</span>
		</div>
	{{/if}}
	<br>
</script>
{% endverbatim %}

<script type="text/javascript">
$(document).ready(function() {
	// $('body').delegate('.xa-viewData', 'click', function(event) {
	// 	var activityId = $(event.currentTarget).parents('tr').data('id');
	// 	W.dialog.showDialog('W.dialog.app.event.ViewParticipanceDataDialog', {
	// 		activityId: activityId,
	// 		success: function(data) {
	// 			alert(data);
	// 		}
	// 	});
	// });

	var participant_name,startTime,endTime;
    //export
    $('.xa-export').click(function(event){
        W.getLoadingView();
		participant_name = $.trim($('[name="participant_name"]').val());
		startTime = $.trim($('[name="start_time"]').val());
		endTime = $.trim($('[name="end_time"]').val());
        var export_id =window.location.search.split('?id=')[1];
        W.getApi().call({
            method: 'get',
            app: 'apps/event',
            resource: 'event_participances-export',
            args: {
				'export_id':export_id,
				'participant_name': participant_name,
				'start_time': startTime,
				'end_time': endTime
			},
            success: function(resp){

                if(resp.code == 200){
                    $('#export_href').prop({
                        'href': resp.download_path,
                        'download': resp.filename
                    }).get(0).click();

                }
                console.log("导出成功");
            },
            error: function(error){
                console.log('导出失败');
            }
        });
    });

	$('.xa-search').click(function(event) {
		var name = $.trim($('[name="participant_name"]').val());
		var member_status = $.trim($('[name="member_status"]').val());
		var red_envelope_status = $.trim($('[name="red_envelope_status"]').val());
		var table = $('[data-ui-role="advanced-table"]').data('view');
		table.reload({
			name: name,
			member_status: member_status,
			red_envelope_status: red_envelope_status
		}, {
			emptyDataHint: '没有符合条件的数据'
		});
	});
    $('.xa-reset').click(function(event) {
		$('[name="participant_name"]').val('');
		$('[name="member_status"]').val('-1');
		$('[name="red_envelope_status"]').val('-1');
	});

});
</script>
{% endblock %}

