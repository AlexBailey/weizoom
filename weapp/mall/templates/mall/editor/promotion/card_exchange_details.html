{% extends "content_base_v2.html" %}
{% block css %}
	<style type="text/css">
    .xui-filterPanel{
    	padding-left: 50px;
    	padding-right: 50px;
    	margin-bottom: 15px;
    }
    .xui-filterPanel .btn-primary{
    	margin: 0;
    }
    .xui-filterPanel .btn{
    	width: 90px;
    	height: 30px;
    	font-weight: bold;
    }
    .xui-thead{
    	background: #C8D1E4;
    }
    input{
    	    width: 150px;
		    line-height: 24px;
		    border: 1px solid #b1dbf1;
		    background-color: #f2f2f2;
		    padding: 0 5px;
		    color: #656565;
		    white-space: nowrap;
    }
    .xb-stripedTable td{
    	height: 40px;
    	line-height: 40px;
    }
	</style>
{% endblock %}
{% block content-panel %}
<div>

    <div class="relative">
		<ul class="breadcrumb">
			<li>您当前所在位置</li>
			<li><a href="/mall2/flash_sale_list/">促销管理</a></li>
			<li class="active">微众卡兑换</li>
		</ul>
	</div>

    <div>
    	<div class="xui-filterPanel">
        	<form>
	        	<span class="mr30">卡号：<input type="text" name="cardNumber" class="xui-cardNumber xa-cardNumber"></span>
	        	<span class="mr50">使用人：<input type="text" name="cardUser" class="xui-cardUser xa-cardUser"></span>
	        	<a class="btn btn-primary mr10 xa-search">查 询</a>
	        	<a class="btn btn-default mr10">重 置</a>
	        	<a class="btn btn-default xa-i-exportBtn">导 出</a>
        	</form>
        </div>
        <div class="xa-listView" data-ui-role="advanced-table" data-app="mall2" data-api="card_exchange_details" data-template-id="#exchange-detail" data-enable-paginator="true" data-enable-load="true"></div>
        </div>
    </div>
</div>


{% endblock %}


{% block js %}

{% verbatim %}
<script type="text/x-jquery-tmpl" id="exchange-detail">
    <table class="table table-bordered table-condensed xb-stripedTable">
		<thead class="xui-thead">
			<th>卡号</th>
			<th>面值</th>
			<th>卡内余额</th>
			<th>使用金额</th>
			<th>使用者</th>
		</thead> 
			<tbody>
				{{each(i,item) items}}
				<tr>
					<td>${item.card_id}</td>
					<td>${item.money}</td>
					<td>${item.remainder}</td>
					<td>${item.used_money}</td>
					<td>${item.user}</td>
				</tr>
				{{/each}}
		</tbody>
    </table>
</script>
{% endverbatim %}

<script type="text/javascript">

$(document).ready(function() {	
	var tableView = $('.xa-listView').data('view');
	$('.xa-search').click(function(){
		var cardNumber = $(".xa-cardNumber").val();
		var cardUser = $(".xa-cardUser").val();
		var args = {
			"cardNumber" : cardNumber,
			"cardUser" : cardUser
		}
		tableView.reload(args);
	});
	$('.xa-i-exportBtn').click(function(event){
        W.getLoadingView();
        var cardNumber = $(".xa-cardNumber").val();
		var cardUser = $(".xa-cardUser").val();
		var args = {
			"cardNumber" : cardNumber,
			"cardUser" : cardUser
		}
        W.getApi().call({
            method: 'get',
            app: 'mall2',
            resource: 'export_card_exchange_details',
            args: args,
            success: function(resp){
                if(resp.code == 200){

                }
                console.log("导出成功");
            },
            error: function(error){
                console.log('导出失败');
                console.log(error)
            }
        });
    });
});

</script>

{% endblock %}
