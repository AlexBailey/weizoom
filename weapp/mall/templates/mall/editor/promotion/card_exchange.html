{% extends "content_base_v2.html" %}
{% block css %}
	<style type="text/css">
		.xui-exchangeTable table tr td{
			text-align: left;
			padding-left: 20px;
		}
		.xui-exchangeTable table tr th{
			width: 110px;
		}
		.xui-exchangeBtn{
			background: #eaeef6;
			text-align: center;
			height: 80px;
			line-height: 80px;
		}
		.xui-exchangeBtn a{
			width: 100px;
		}
		.xui-i-put{
			border-bottom: 1px dotted #ddd;
			padding-bottom: 10px;
			padding-top: 10px;
		}
        .xui-i-put div{
        	padding: 5px 0;
        }
		.xui-i-money{
			width: 125px;
		}
		.xui-i-add{
			cursor: pointer;
			display: inline-block;
			margin-top: 7px;
			font-weight: bold;
		}
		.xui-noborder{
			border:none;
		}
		.xui-i-num{
			width: 90px;
		}
		.xui-i-detail{
			margin-left: 15px;
			display: none;
			cursor: pointer;
		}
		.ml35{
			display: inline-block;
		}
	</style>
{% endblock %}
{% block content-panel %}
<div>

<div class="relative">
	<ul class="breadcrumb">
		<li>您当前所在位置</li>
		<li><a href="/mall2/flash_sale_list/">促销管理</a></li>
		<li class="active">微众卡兑换</li>
	</ul>
</div>

<div class="xui-exchangeTable">
	<table class="table table-bordered">
		<tr>
        	<th>兑换要求：</th>
        	<td>
	        	<span>绑定手机号</span>
	        	<select>
	        		<option value="1">绑定手机号</option>
	        		<option value="0">无条件</option>		
	        	</select>
        	</td>
		</tr>
		<tr>
        	<th>兑换奖励：</th>
        	<td>微众卡</td>
		</tr>
		<tr>
        	<th>兑换奖项：</th>
        	<td>
        	    <form>
        		<div class="xui-i-exchange xa-i-exchange">
        		    <div class="xui-i-put">
	        		    <div>
	        		    	<span>1.</span>
	        		    	使用积分：<input type="text" class="xa-i-integral" name="integral">
	        		    </div>
	                    <div class="ml10">
	                    	兑换微众卡：<input type="text" class="xui-i-money xa-i-money" name="money">
	                    	<span class="ml10 mr30">元</span>
			                号段：<input type="text" class="xui-i-num xa-i-snum" name="snum">
			                <span class="ml10 mr10">-</span>
			                <input type="text" class="xui-i-num xa-i-endnum" name="endnum">		                
	                        <a class="xui-i-detail xa-i-detail" data-toggle="modal" 
   data-target="#myModal">使用详情</a>
	                    </div>
	                </div>
        		</div>
        		</form>
        		<div class="xui">
			    	<a class="xui-i-add xa-i-add">+添加</a>
			    </div>
        	</td>
		</tr>
    </table>
    <div class="xui-exchangeBtn">
    	<a class="btn btn-primary xa-btnSubmit">完成设置</a>
    </div>
</div>
</div>


{% endblock %}


{% block js %}

{% verbatim %}
<script type="text/x-jquery-tmpl" id="exchange-input">
	<div class="xui-i-put">
    	<div>
	        <span>${num}.</span>
	        使用积分：<input type="text" class="xa-i-integral" name="integral">
	    </div>
	    <div class="ml10">
	        兑换微众卡：<input type="text" class="xui-i-money xa-i-money" name="money">
	        <span class="ml10 mr30">元</span>
			号段：<input type="text" class="xui-i-num xa-i-snum" name="snum">
			<span class="ml10 mr10">-</span>
			<input type="text" class="xui-i-num xa-i-endnum" name="endnum">		                
	        <a class="xui-i-detail xa-i-detail" data-toggle="modal" 
   data-target="#myModal">使用详情</a>
	    </div>
	</div>
</script>
{% endverbatim %}

<script type="text/javascript">
$(document).ready(function() {
	var i = 1;
	$(".xa-i-add").click(function(){   
	    i ++;
	    var arg =[{num:i}];
		$("#exchange-input").tmpl(arg).appendTo(".xa-i-exchange");
	});   
	$(".xa-btnSubmit").click(function(){
		if(!$("input").attr("readonly")){
			$("input").attr("readonly",true)
			          .addClass("xui-noborder");
			$(".xa-i-detail").show();
			$(".xa-i-add").hide();
			$(this).html("修改");
			var prize = [];
			var money = $(".xa-i-money");
			var integral = $(".xa-i-integral");
            var snum = $(".xa-i-snum");
			var endnum = $(".xa-i-endnum");
			var isBind = $("option:selected").val();
			for(i=0;i<money.length;i++){
				var moneyData = money[i].value;
				var integralData = integral[i].value;
                var snumData = snum[i].value;
                var endnumData = endnum[i].value;
				var item = {
					money:moneyData,
					integral:integralData,
                    snum:snumData,
                    endnum:endnumData
				}
				prize.push(item);
			} 
			prize = JSON.stringify(prize);
			W.getApi().call({
			    method: 'post',
			    app: 'mall2',
			    api: 'card_exchange',
			    args: {
			    	"isBind" : isBind,
			    	"prize" : prize
			    },
			    scope: this,
			    success: function(data) {
			        W.showHint('success', '保存成功');
			      },
			    error: function(resp) {
			        W.showHint('error', '操作失败')
			    }
			})          
		}else{
            $("input").attr("readonly",false)
		          .removeClass("xui-noborder");
		    $(".xa-i-detail").hide();
			$(this).html("保存"); 
			$(".xa-i-add").show();
		}     
	});
});
</script>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" 
   aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
	            <button type="button" class="close" 
	               data-dismiss="modal" aria-hidden="true">
	                  &times;
	            </button>
            <h4 class="modal-title" id="myModalLabel">
               查看微众卡()使用详情
            </h4>
        </div>
        <div class="modal-body">
        <div class="clearfix">
        	<a class="btn btn-primary fl" style="margin: 0"><span>&lt;</span>返回设置兑换平台</a>
        	<a class="btn btn-default fr">导出订单</a>
        </div>
        <div class="mt10">
        	<table class="table table-bordered">
        		<thead>
        		<tr>
                	<th>11111111</th>
                    <th>11111111</th>
                    <th>11111111</th>
                    <th>11111111</th>
        		</tr>
        		</thead>
        		<tr>
                	<td>11111111</td>
                    <td>11111111</td>
                    <td>11111111</td>
                    <td>11111111</td>
        		</tr>
        		<tr>
                	<td>11111111</td>
                    <td>11111111</td>
                    <td>11111111</td>
                    <td>11111111</td>
        		</tr>	
        	</table>
        </div>	
        </div>
    </div>
</div>
</div>
{% endblock %}
