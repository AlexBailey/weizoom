{% extends "content_base_v2.html" %}
{% load common_tag %}
{% load account_filter %}


{% block content-panel %}

<div class="xui-expiredTime-page">
	<ul class="breadcrumb">
		<li>您当前所在位置</li>
		<li>
			<a href="mall/editor/edit_expired_time.html">订单管理</a>
		</li>
		<li class="active">所有订单</li>
	</ul>
   <a href="/mall2/sender_info/">+新增地址</a>
     <div
                data-ui-role="advanced-table"
                data-app="mall2"
                data-resource="sender_info_list"
                data-enable-paginator="true"
                data-template-id="#mall-orders-sender"
                data-init-sort="-created_at"
                data-selectable = "false"
                data-user-webapp-id={{user.get_profile.webapp_id}}
            >
            </div>
   
	
</div>
{% endblock %}

{% block js %}
{% verbatim %}
 <script id="mall-orders-sender" type="text/x-jquery-tmpl">
	<table class="table">
		<thead>
			<tr class="xui-trHeight" style="background:#C0C0C0">
				<!--<th width="80">默认</th>-->
				<th width="80">发件人信息</th>
				<th width="80">发件人电话</th>
				<th width="80">所在地区</th>
				<th width="80">详细地址</th>
				<th width="80">邮政编码</th>
				<th width="80">操作</th>
			</tr>
		</thead>
		<tbody>
            {{each(i, sender) items}}
                <tr data-id="${sender.id}" data-name = "${sender.name}">
                	<!--默认-->
                	
                    <!--<td class="nowrap">
                    	{{if is_selected ==1}}
                        <input type="radio" checked="true" class="xa-radio" />   
                        {{else}}
                        <input type="radio" class="xa-radio" />
                        {{/if}}
                        ${sender.is_selected}
                    </td>-->
                   
                    <!--发货人姓名-->
                    <td>
                        <div>${sender.sender_name}</div>
                        
                    </td>
                    <!--发货人电话-->
                    <td class="nowrap">
                        <div>${sender.sender_tel}</div>
                    </td>
                    <!--所在地区-->
                    <td class="nowrap">
                        <div>${sender.area}</div>
                    </td>
                    <!--详细地址-->
                    <td class="nowrap">
                        <div>${sender.sender_address}</div>  
                        <div hidden="true">${sender.remarks}</div>
                    </td>
                    <!--邮政编码-->
                    <td class="nowrap">
                        <div>${sender.code}</div>                        
                    </td>
                    <!--操作-->
                    <td class="tc" style="width:100px;">
                    	
                        <a href="javascript:void(0);" data-id="${sender.id}" class="xui-delete-sender  mr10">删除</a>
                        <a href="/mall2/sender_info/?id=${sender.id}" data-id="${sender.id}" data-name="${sender.name}" class=" mr10">修改</a>
                        {{if is_selected == 1}}
                        <a href="javascript:void(0);" data-id="${sender.id}" status="${sender.is_selected}" data-name="${sender.name}" class="xui-default-sender btn-danger">默认</a>
                        {{else}}
                        <a href="javascript:void(0);" data-id="${sender.id}" status="${sender.is_selected}" data-name="${sender.name}" class="xui-default-sender ">默认</a>
                        {{/if}}
                    </td>
                </tr>
			{{/each}}
		</tbody>        
	</table>
</script>

<script type="text/javascript">
$(document).ready(function() {

    $('body').delegate('.xui-delete-sender', 'click', function (event) {

        var id = $(this).attr('data-id');
//      console.log(id+"@@@@");
        var $el = $(event.currentTarget);
        W.requireConfirm({
            $el: $el,
            msg : '确定删除？',            
            isTitle: false,
            confirm: function(){
                W.getApi().call({
                    app: 'mall2',
                    api: 'sender_info',
                    method: 'delete',
                    args: {id: id},
                    success: function(data) {
                    	console.log(data);
                        //根据data内容动态显示
                        if(data.msg){
                            W.showHint('error',data.msg);
                        }else{
                            W.finishConfirm();
                            $('div[data-ui-role="advanced-table"]').data('view').reload();
                        }
                    },
                    error: function(resp) {
                        W.showHint('error','失败');
                    },
                    scope: this
                });
            }
        });

    });
    
    //默认信息
    $('body').delegate('.xui-default-sender', 'click', function (event) {
    	
         var $self = $(this),
         	status = $self.attr('status'),
         	id     = $self.attr('data-id');
         	console.log(id+ '---'+ status);
         	if(status == '1'){
         		return false;
         	}
               W.getApi().call({
         　　　　　 method:'post',          
          　　　　　app: 'mall2',
         　　　　　 resource:'sender_info/?id='+id,
          　　　　　args:{
          			id:id,
          			is_selected:status
          	},
	      　　　　　success: function(data) {               		  	
				       $self.addClass("btn-danger");
				       $self.parents('tr').siblings().find('.xui-default-sender').removeClass('btn-danger')
				       
					},
					error: function(resp) {
						
					}
				});
    });
});

</script>
{% endverbatim %}
{% endblock %}
