{% load webapp_filter %}
{% load project_filter %}

<!DOCTYPE html>
<html class="{% if user.is_from_android %} android{% endif %}{% if not user.is_from_weixin %} notweixin{% endif %}">
    <head>
        <meta charset="UTF-8" />
        <title>{{ page_title }}</title>
        {% if request.enable_sql_monitor %}
        <link type="text/css" rel="stylesheet" media="all" href="/static/bootstrap/css/bootstrap.css">
        {% endif %}

        
        <!-- *start_prunt_task* -->
        <!-- [prunt_task] 
            {
                "task": "weizoom-merge",
                "args": {
                    "dest":"cdn/standard_static/css/webapp_all.css",
                    "path_map": {
                        "termite_static": "termite/static"   
                    }
                }
            }
        -->
        <link type="text/css" rel="stylesheet" href="/termite_static/v3/css/base.css">
        <link type="text/css" rel="stylesheet" href="/termite_static/v3/css/webapp_default.css">
        <link type="text/css" rel="stylesheet" href="/termite_static/v3/css/widget.css">
        <link type="text/css" rel="stylesheet" href="/termite_static/css/common_widget.css">
        <link type="text/css" rel="stylesheet" href="/termite_static/v3/css/idangerous.swiper.css">
        <link type="text/css" rel="stylesheet" media="all" href="/static_v2/css/emojilc6cc2.css">
        <!-- *end_prunt_task* -->

        <link type="text/css" rel="stylesheet" href="/webapp_static/backend_{{request.template_name}}/css/{{request.template_name}}.css">
        {% block css %}{% endblock %}


        <!-- *start_prunt_task* -->
        <!-- [prunt_task] 
            {
                "task": "weizoom-merge",
                "args": {
                    "dest":"cdn/standard_static/js/webapp_all.js",
                    "path_map": {
                        "termite_static": "termite/static"   
                    }
                }
            }
        -->
        <script type="text/javascript" src="/termite_static/v3/gmu/zepto.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/gmu-2.1.1.js"></script>
        <script type="text/javascript" src="/termite_static/v3/lib/idangerous.swiper.js"></script>
        <script type="text/javascript" src="/termite_static/v3/lib/fastclick.js"></script>
        <!--<script type="text/javascript" src="/termite_static/v3/lib/refresh.js"></script> 
        <script type="text/javascript" src="/termite_static/v3/lib/$iscroll.js"></script> -->
        <script type="text/javascript" src="/termite_static/v3/lib/lazyload.js"></script>
        <script type="text/javascript" src="/termite_static/v3/system/system.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/cookie.js"></script>
        <script type="text/javascript" src="/termite_static/backbone/underscore-1.4.4.min.js"></script>
        <script type="text/javascript" src="/termite_static/v3/webapp/backbone_lite.js"></script>
        <script type="text/javascript" src="/termite_static/v3/system/validate.js"></script>
        <script type="text/javascript" src="/termite_static/v3/webapp/common.js"></script>
        <script type="text/javascript" src="/termite_static/v3/webapp/inputable_page.js"></script>
        <script type="text/javascript" src="/termite_static/v3/webapp/edit_order_page.js"></script>
        <script type="text/javascript" src="/termite_static/v3/webapp/localStorage_helper.js"></script>
        <script type="text/javascript" src="/termite_static/v3/webapp/shopping_cart_page.js"></script>
        <script type="text/javascript" src="/termite_static/v3/webapp/buy_custom_model_product_page.js"></script>
        <script type="text/javascript" src="/termite_static/v3/webapp/edit_address_page.js"></script>
        <script type="text/javascript" src="/termite_static/v3/webapp/order_detail_page.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/alert.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/attentionAlert.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/counter.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/goBack.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/swipeImage.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/swipeDialog.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/swipeMask.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/areaPop.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/topDropdownNav.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/globalNav.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/returnTop.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/weixinnavbar.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/weshopBottomNav.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/weshopSideNav.js"></script>

        <script type="text/javascript" src="/termite_static/v3/gmu/widget/integralMechanism.js"></script>
        <script type="text/javascript" src="/termite_static/v3/gmu/widget/productsPrice.js"></script>
        <script type="text/javascript" src="/termite_static/v3/system/api.js"></script>
        <script type="text/javascript" src="/termite_static/v3/system/crypto-js.js"></script>
        <script type="text/javascript" src="/termite_static/v3/system/md5.js"></script>
        <script type="text/javascript" src="/termite_static/v3/webapp/webapp.js"></script>
        <script type="text/javascript" src="/termite_static/v3/system/preview_imges.js"></script>
        <script type="text/javascript" src="/termite_static/v3/system/debug.js"></script>
        <!-- *end_prunt_task* -->


        <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
        <meta name="x5-orientation" content="portrait">
        <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport">
        <meta content="telephone=no" name="format-detection">
    </head>
    <body data-ui-role="integralMechanism" data-value="{{ cur_request_member.token }}" data-key="fmt" is-under-develop="{{ under_develop }}">
        <!-- xt-errMsg for test -->
        <input id="xt-errMsg" type="hidden" value="" />

        <div id="homePageUrlZone" style="display: none;">/workbench/jqm/preview/?{{homepage_workspace_info|safe}}</div>

        {% if is_deleted_data %}
            <div data-role="content" data-theme="x" class="tc" style="background: transparent;">
                <h2 style="margin-top: 100px;">您访问的数据已被删除</h2>
                <a data-theme="x" href="./?woid={{request.webapp_owner_id}}&module=mall&model=homepage" data-role="button" class="xui-btn mt20">返回首页</a>
            </div>
        {% else %}
             <div data-ui-role="attentionAlert" class="xui-attentionAlert"
                {% if not request.member.is_subscribed %}
                    data-is-show-button="true"
                {% endif %}
                {% if not hide_non_member_cover %}
                    data-is-show-cover="true"
                {% endif %}
                data-id="{{request.webapp_owner_id}}"
                data-qrcode-image="{{ request.webapp_owner_info.qrcode_img }}"
                data-varnish="{{is_varnish_url}}"
                >
            </div>
            {% block content-panel %}{% endblock %}
        {% endif %}

        {% if global_navbar %}
        {% include "global_navbar.html" %}
        {% endif %}
        {% include "weapp_jssdk_base.html" %}

        <div id="jsons" style="display: none;">
            {% for json in jsons %}
            <div id="__json-{{json.name}}">
                {{json.content|format_json|safe}}
            </div>
            {% endfor %}
        </div>

        <script type="text/javascript">
            var isHideWeixinOptionMenu = {% if is_hide_weixin_option_menu %}true{% else %}false{% endif %};
            W.onloadHandlers = [];
            W.currentPageName = "{{current_page_name}}";
            W.projectId = "{{request.project.id}}";
            W.webappOwnerId = "{{request.webapp_owner_id}}";
            W.isUnderDevelopMode = {% if under_develop %}true{% else %}false{% endif %};
            W.curRequestMemberToken = "{{ cur_request_member.token }}";
            W.visitHistory = "{{ visit_histroy_url }}";
            W.urlTitle = "{{ visit_histroy_url_title }}";
            if (W.urlTitle == ''){
                W.urlTitle = '{{ show_system_name }}';
            }
            W.pageTitle = "{{page_title}}";
            W.errorMessage = null;
            localStorage.setItem('woid',W.webappOwnerId);

            {% if messages %}
            {% for message in messages %}
            W.errorMessage = "{{message}}";
            {% endfor %}
            {% endif %}

            $(document).ready(function() {
                if (W.visitHistory) {
                   W.showVisitHistory(W.urlTitle, W.visitHistory);
                }

                if (W.errorMessage) {
                    $("body").alert({
                        isShow: true,
                        info: W.errorMessage,
                        speed: 3000
                    });
                }

                // 默认列表页--非会员点击会员中心
                var height = $(window).height();
                
                var $twoDimension = $('.xui-two-dimension');

                var showSwiper = function(){
                    $('body').swipeMask('show');
                    $('.mask').css({
                        height: height,
                        background: 'rgba(132,132,132,0.5)',
                        position:'fixed'
                    });
                    $('.xui-two-dimension').css({
                        top: height/2,
                        'margin-top': -185,
                        display:'block'
                    });
                };

                var isUserCenterLink = function(url){
                    if (url.indexOf('module=user_center') > 0 &&
                        url.indexOf('model=user_info') > 0 &&
                        url.indexOf('action=get') > 0 ) {
                        return true;
                    }else{
                        return false;
                    }
                };

                $('.xa-wepage-navbar-link').click(function(event){
                    var url = $(event.currentTarget).find('a').attr('data-link');
                    if (url.length == 0 || url.indexOf('javascript:') >= 0) {
                        return;
                    }
                    url +='&fmt='+W.curRequestMemberToken;
                    if (isUserCenterLink(url) && W.curRequestMemberToken.length == 0) {
                        /* 非会员显示二维码 */
                        showSwiper();
                    } else {
                        if( url.indexOf('http://') == 0 || url.indexOf('https://') == 0){
                            window.location.href = url;
                        }else{
                            window.location.href = "http://"+ window.location.host + url;
                        }
                    }
                });

                $('.mask').click(function(){
                    $('body').swipeMask('hide');
                    $('.xui-two-dimension').hide();
                });
            });
            {# 百度统计代码开始 #}
            var _hmt = _hmt || [];
            (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?ee18872310bbb14797f87c9eda185a85";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
            })();
            {# 百度统计代码结束 #}
        </script>

        {% if under_develop %}
        <script type="text/javascript">
            $(function() {
                $('body').append('<a style="top:90px; height:40px; width:40px; color:#BBB; border-radius:20px; left:10px; position:fixed; z-index:99; background-color: rgba(46, 94, 134, 0.1); line-height:40px; text-align:center;" href="/simulator/2/">H</a>')
            });
        </script>
        {% endif %}

        {% block js %}{% endblock %}
    </body>
</html>
