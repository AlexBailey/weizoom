{% extends "apps_base.html" %}

{% block css %}
<style type="text/css">
    .wui-group-container .wui-i-body {
         padding-bottom: 18px;
    }
	h1 {
		color: #00F;
	}
    .xui-share {
        background: url("/termite_static/img/component/powerme/share.png") no-repeat scroll 82% 10px / 53% auto rgba(0, 0, 0, 0);
        position: fixed;
        text-align: center;
        top: 5%;
        width: 100%;
        z-index: 10001;
    }
    .xui-share.xa-share > div p {
        color: #fff;
        text-align: center;
        width: 100%;
    }
    /* 分享的closeButton */
    .xui-colseButton {
        margin-top: 18%;
        color: #fff;
    }

    .xui-attention{
        position: fixed;
        top: 12%;
        width: 100%;
        text-align: center;
        z-index: 10001;
    }
    .xui-attention .xui-twoDimensionBox {
        background: #fff;
        border-radius: 8px;
        padding: 5px 20px 20px 20px;
        width: 260px;
        display: inline-block;
    }
    .xui-attention .xui-twoDimension{
        display: block;
        height: 180px;
        position: relative;
        width: 180px;
        margin-left: 40px;
        margin-top: 20px;
        margin-bottom: 15px;
    }
    .xui-successHint {
        background: #fff;
        border-radius: 5px;
        position: fixed;
        top: 30%;
        z-index: 10001;
        text-align: center;
        width: 80%;
        margin-left: 11%;
        padding-top: 25px;
        padding-bottom: 20px;
        line-height: 25px;
    }
    .xui-groupMsg-payHint .xui-successHint {
        height: auto;
    }
    ..xui-successHint .xui-i-msg{
        color:#868686;
        margin-left: auto;
        margin-right: auto;
        padding-left: 10px;
        padding-right: 10px;
    }
    .xui-groupMsg-payHint .xui-successHint .xui-i-msg{
        margin-left: auto;
        margin-right: auto;
        padding-left: 10px;
        padding-right: 10px;
    }
    .xui-groupMsg-payHint .xui-successHint .xa-i-msg-not-meber{
        color:#868686;
    }
    .xui-successHint p.xui-i-msg-title.xa-i-msg-title {
        font-size: 1.2rem;
        color: #4C4C4C;
        display: inline-block;
    }
    p.xui-i-msg-title-status.xa-i-msg-title-status {
        font-size: 1.2rem;
        color: #ff2742;
        display: inline-block;
    }
    button.wui-i-btn-groupMsg-yes,button.wui-i-btn-groupMsg-no{
        width: 40%;
        text-align: center;
        font-size: 1rem;
        height: 2rem;
        border-radius: 2px;
        font-family: "黑体";
        margin-top: 4%;
    }
    button.wui-i-btn-groupMsg-yes{
        background: #ff2742;
        color: #fff;
        border: 0;
    }
    button.wui-i-btn-groupMsg-no{
        background: #fff;
        color: #414141;
        border: 1px solid #EEEEEE;
    }
    .wui-i-product-description-title{
        text-align: center;
        color: #E6E6E6;
        height: 50px;
        background: url("/termite_static/img/component/group/detail_bg.png") no-repeat;
        background-position-y: 90%;
        background-position-x: 50%;
    }
    .xui-groupMsg-xui-i-msg-title {
        font-size: 1.2rem;
        color: #ff2742;
    }
    p.xui-i-msg.xa-i-msg {
        color: #868686;
        padding: 0 15px 0 15px;
    }
</style>
{% endblock %}

{% block content-panel %}
    {{ page_html_content|safe }}
    <div class="xui-share xa-share none">
        <div style="margin-top: 49%">
            <p>邀请你的小伙伴，帮你一起拼团</p>
        </div>
        <div class="xui-colseButton xui-spritebg xa-colseButton">知道了</div>
    </div>
    <!-- 支付未完成弹窗页面 -->
    <div class="xui-groupMsg xa-groupMsg none">
        <div class="f15 xui-successHint">
            <p class="xui-groupMsg-xui-i-msg-title xa-groupMsg-xui-i-msg-title"></p>
            <p class="xui-i-msg xa-i-msg"></p>
            <div class="wui-i-btngroup">
                <button class="wui-i-btn-groupMsg-yes wa-i-btn-groupMsg-yes">是</button>
                <button class="wui-i-btn-groupMsg-no wa-i-btn-groupMsg-no">否</button>
           </div>
        </div>
    </div>
    <!-- 支付成功弹窗页面 -->
    <div class="xui-groupMsg-payHint xa-groupMsg-payHint none">
        <div class="f15 xui-successHint">
            <p class="xui-i-msg-title xa-i-msg-title"></p>
            <p class="xui-i-msg-title-status xa-i-msg-title-status"></p>
            <p class="xui-i-msg xa-i-msg"></p>
            <p class="xui-i-msg xa-i-msg-not-meber"></p>
        </div>
    </div>
    <!-- 成功、失败弹窗页面 -->
    <div class="xui-groupMsg-Hint xa-groupMsg-Hint none">
        <div class="f15 xui-successHint">
            <p class="xui-i-msg-title xa-i-msg-title"></p>
            <p class="xui-i-msg-title-status xa-i-msg-title-status"></p>
            <p class="xui-i-msg xa-i-msg"></p>
            <div class="wui-i-btngroup">
                <button class="wui-i-btn-groupMsg-yes wa-i-btn-groupMsg-yes">确定</button>
           </div>
        </div>
    </div>
    <!-- 非会员引导 -->
    <div class="xui-attention xa-attention-guest none">
        <div class="xui-twoDimensionBox">
            <div class="xa-attention-tip-one" style="margin-top: 32px;">
                <p style="font-size: 1.1rem;">长按二维码，关注后即可开团</p>
            </div>
            <p style="color:#9E9E9E;">方便您查看团购情况</p>
            <img src="{{ request.webapp_owner_info.qrcode_img }}" alt="" class="xui-twoDimension">
        </div>
    </div>
    <div class="wui-i-description wui-i-product-description">
        <div class="xui-section xui-production-panel pt0 xa-production" style="border:0;">
            <div class="xui-section-title xui-section-item zoom">
                <div class="wui-i-product-description-title pt10">滑动查看详情</div>
                <div class="xui-productDetail-content rawHtml pt10 pl10 pb10 xa-productDetail-content none">
                {{ product_detail|safe }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
<script type="text/javascript">
	var is_helped = true;
    var is_self_page = true;
    var is_group_leader = false;
    var only_remain_one_day = false;
    var page_owner_member_id = '';
    var page_owner_icon = '';//用户头像
    var group_type = '';
    var group_relation_id = {% if group_relation_id %}'{{group_relation_id}}'{% else %}''{% endif %};
    var product_id = {% if product_id %}'{{product_id}}'{% else %}''{% endif %};
    var settings_domain = '{{settings_domain}}';
    var product_original_price = 0;
    var product_mysql_name = '';
    var pic_url = '';
    var product_group_price = 0;
    var order_id = '';
    var is_from_pay_result = false;
    var is_helper_unpaid = false;

	$(function(){
        //隐藏参与活动按钮
        $('.xa-submitButtonContainer').hide();
        //选择团购按钮点击
        $('.wui-i-choose_group_box').delegate('li', 'click', function(){
            var $this = $(this).find('span').first();
            var type = $this.attr('data-type');
            var className = 'radio' === type ? 'radio-select' : 'checkbox-select';
            if('radio' === type){
                $(this).siblings().find('span').removeClass(className);
                if($this.hasClass(className)) return;
            }
            $this.toggleClass(className);
        });
        if(W.isPC){
            return false;
        }
        $('.wui-appParticipantResult-Cover').hide();

        //展示参与统计
        getDynamicData();

        //展示商品详情
        var detail_content = $('.wui-i-product-description');
        $('.wui-i-body').append($(detail_content));
        //返回角度
        function GetSlideAngle(dx, dy) {
          return Math.atan2(dy, dx) * 180 / Math.PI;
        }

        //根据起点和终点返回方向 1：向上，2：向下，3：向左，4：向右,0：未滑动
        function GetSlideDirection(startX, startY, endX, endY) {
          var dy = startY - endY;
          var dx = endX - startX;
          var result = 0;

          //如果滑动距离太短
          if(Math.abs(dx) < 2 && Math.abs(dy) < 2) {
              return result;
          }

          var angle = GetSlideAngle(dx, dy);
          if(angle >= -45 && angle < 45) {
              result = 4;
          }else if (angle >= 45 && angle < 135) {
              result = 1;
          }else if (angle >= -135 && angle < -45) {
              result = 2;
          }
          else if ((angle >= 135 && angle <= 180) || (angle >= -180 && angle < -135)) {
              result = 3;
          }

          return result;
        }

        //滑动处理
        var startX, startY;
        document.addEventListener('touchstart',function (ev) {
          startX = ev.touches[0].pageX;
          startY = ev.touches[0].pageY;
        }, false);
        document.addEventListener('touchend',function (ev) {
          var endX, endY;
          endX = ev.changedTouches[0].pageX;
          endY = ev.changedTouches[0].pageY;
          var direction = GetSlideDirection(startX, startY, endX, endY);
          switch(direction) {
              case 0:
                  break;
              case 1:
                  if (product_id!=''){
                      showProductDetails();
                    }
                  break;
              case 2:
                  break;
              case 3:
                  break;
              case 4:
                  break;
              default:
          }
        }, false);

    });
	function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null) return unescape(r[2]);
        return null;
    }
//    function DelQueryString(name){
//        var url = window.location.search.substr(1);
//        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
//        console.log(url.replace(reg,""));
//        return url.replace(reg,"");
//    }

    //发送请求，单独获取动态数据，优化首页时间
    function getDynamicData(){
        loadingStatus(true);
        var fid = GetQueryString("fid");
        var from = GetQueryString("from");
        W.getApi().call({
            app: 'm/apps/group',
            resource: 'm_group',
            method: 'get',
            args: {
                webapp_owner_id: W.webappOwnerId,
                id: W.appRecordId,
                group_relation_id: group_relation_id,
                fid: fid,
                from: from
            },
            success: function(data) {
                console.log(data);
                //隐藏loading动画元素
                loadingStatus(false);
                //渲染按钮状态
                updateActivityStatus(data);
                getProductDetails();
                if(W.group_status != ''){
                    if(W.group_status != '团购未生效'){
                        if(group_type != ""){
                            $('.wui-i-product-price-group').show();
                            $('.wui-i-title-pic').addClass('wui-i-title-pic-'+group_type);
                            $('.wui-i-product-price-group-original-price').html(product_original_price+'元');
                            $('.wui-i-product-price-group-group-price').html(product_group_price+'元');
                        }
                        //渲染团员名单
                        showHelperInfo(data);
                        if(W.group_status == '团购进行中'){
                            //启动倒计时
                            $('.wa-timing').removeClass('none');
                            renderTime(data.member_info.timing);
                        }else{
                            $('.wa-timing').addClass('none');
                        }
                        //进度bar动画
                        runProcessBar(data.member_info.grouped_number,data.member_info.group_type);
                    }
                }
            },
            error: function(data) {
                //隐藏loading动画元素
                loadingStatus(false);
                if(data.errMsg == 'is_deleted'){
                    deletedRecord();
                }else{
                    wuiAlert(data.errMsg)
                }
            }
        });
    }

	function updateActivityStatus(data){
        //检查活动状态,更新参与按钮并绑定事件
        member_info = data.member_info;
        W.activityStatus = member_info.activity_status;
        W.isMember = member_info.isMember;
        W.member_id = member_info.member_id;
        is_self_page = member_info.self_page;
        is_group_leader = member_info.is_group_leader;
        only_remain_one_day = member_info.only_remain_one_day;
        is_helped = member_info.is_helped;
        page_owner_member_id = member_info.page_owner_member_id;
        W.group_status = member_info.group_status;
        group_type = member_info.group_type;
        product_original_price = member_info.product_original_price;
        product_mysql_name = member_info.product_mysql_name;
        pic_url = member_info.pic_url;
        product_group_price = member_info.product_group_price;
        page_owner_icon = member_info.page_owner_icon;
        order_id = member_info.order_id;
        console.log(order_id);
        is_from_pay_result = member_info.is_from_pay_result;
        is_helper_unpaid = member_info.is_helper_unpaid;
        if (W.group_status == '团购进行中' && is_from_pay_result == true){
            showSuccessPaidWin()
        }
        if(page_owner_icon != ""){
            $('.wui-i-shop_circle').find('img').attr('src', page_owner_icon);
        }
        if(product_mysql_name !=""){
            $('.wui-i-product-title').html(product_mysql_name);
        }
        if(pic_url !=""){
            $('.wui-i-product-img').find('img').attr('src', pic_url);
        }
        updateBtnStatus();
    }

    function updateBtnStatus(){
        if('进行中' != W.activityStatus){
            if('未开启' == W.activityStatus){
                $('.wa-notready').show();
                return false;
            }else{
                $('.wa-closed').show();
            }
        }
        if('进行中' == W.activityStatus){
            //团购成功、团购失败状态
            if (W.group_status == '团购进行中' || W.group_status == '团购未生效' || W.group_status == ''){
                //如果是自己的主页
                if(is_self_page){

                    if(is_group_leader){
                        $('.wa-using').text('邀请好友参团').on('click', function(){
                                openGuideMask();
                            }).show();
                    }else{
                        if(W.group_status == '团购未生效'){
                            openUnpaidWin();
                        }else{
                            if(only_remain_one_day){
                                openRemainOneDayWin();
                            }
                        }
                        $('.wa-using-join').text('直接参团').on('click', openJoinGruop).show();
                        if(W.isMember){
                            $('.wa-using').text('我要开团').on('click', openGruop).show();
                        }else{
                            $('.wa-using').text('我要开团').on('click', openGuestMask).show();
                        }
                    }
                }else{
                    if(W.group_status == '团购进行中'){
                        var $powerBtn = $('.wa-power');
                        if(!is_helped){
                            if(is_helper_unpaid){
                                openUnpaidWin();
                            }
                            $powerBtn.find('.wa-power-btn-action').html('我要参团');
                            $powerBtn.on('click', function(){
                                    JoinGroup();
                                }).show();
                            $('.wa-using-join').text('看看还有什么团').on('click', openJoinGruop).show();
                        }else{
                            $('.wa-using').text('邀请好友参团').on('click', openGuideMask).show();
                            $('.wa-using-join').text('我要开团').on('click', openJoinGruop).show();
                        }
                    }else{
                        $('.wa-using-join').text('直接参团').on('click', openJoinGruop).show();
                        if(W.isMember){
                            $('.wa-using').text('我要开团').on('click', openGruop).show();
                        }else{
                            $('.wa-using').text('我要开团').on('click', openGuestMask).show();
                        }
                    }
                }
            }else{
                $('.wa-using-join').text('看看还有什么团').on('click', openJoinGruop).show();
                if (W.group_status == '团购成功'){
                    showGroupSuccess();
                }
                if(W.group_status == '团购失败'){
                    showGroupFailure();
                }
            }
        }else{
            if (W.group_status == '团购成功'){
                showGroupSuccess();
            }
            if(W.group_status == '团购失败'){
                showGroupFailure();
            }
            $('.wa-using-join').text('看看还有什么团').on('click', openJoinGruop).show();
        }
    }
    //我要开团
	function openGruop(){
        var choosen_group_type = $('.wui-i-choose_group_box').find('.radio-select').attr('data-input-group_type');
        var choosen_group_days = $('.wui-i-choose_group_box').find('.radio-select').attr('data-input-group_days');
        var choosen_group_price = $('.wui-i-choose_group_box').find('.radio-select').attr('data-input-group_price');
        var product_id = $('.wui-i-choose_group_box').find('.radio-select').attr('data-input-product_id');
        if (choosen_group_type){
            W.getApi().call({
                app: 'm/apps/group',
                resource: 'group_participance',
                method: 'post',
                args: {
                    webapp_owner_id: W.webappOwnerId,
                    group_record_id: W.appRecordId,
                    fid: W.member_id,
                    group_type: choosen_group_type,
                    group_days: choosen_group_days,
                    group_price: choosen_group_price,
                    product_id: product_id
                },
                success: function(data) {
                    var relation_belong_to = data.relation_belong_to;
                    var data_href = "http://"+settings_domain+"/mall/purchasing/?woid="+W.webappOwnerId+"&product_ids="+product_id+"&product_counts=1&product_model_names=standard&group_id="+relation_belong_to+"&activity_id="+W.appRecordId;
                    window.location.href = data_href;
                    console.log('data_href is:');
                    console.log(data_href);
                },
                error: function(data) {
                    wuiAlert(data.errMsg);
                }
            });
        }else{
            wuiAlert('请选择团购类型！');
        }
    }

    // 直接参团
    function openJoinGruop(){
        var link = window.location.origin + '/m/apps/group/m_group_list/?webapp_owner_id='+W.webappOwnerId;
        window.location.href = link;
    }

    // 我要参团
    function JoinGroup(){
        is_helped = true;
        W.getApi().call({
            app: 'm/apps/group',
            resource: 'group_participance',
            method: 'put',
            args: {
                webapp_owner_id: W.webappOwnerId,
                group_relation_id: group_relation_id,
                fid: page_owner_member_id
            },
            success: function(data) {
                var data_href = "http://"+settings_domain+"/mall/purchasing/?woid="+W.webappOwnerId+"&product_ids="+product_id+"&product_counts=1&product_model_names=standard&group_id="+group_relation_id+"&activity_id="+W.appRecordId;
                window.location.href = data_href;
            },
            error: function(data) {
                if(data.errMsg){
                    is_helped = false;
                    wuiAlert(data.errMsg);
                }
            }
        });
    }

    //隐藏所有
    $('.mask').click(function(){
        mask('hide');
        $('.xui-groupMsg-payHint').addClass('none');
        $('.xui-attention').addClass('none');
        $('.xui-groupMsg').addClass('none');
        $('.xui-groupMsg-Hint').addClass('none');
        $('.xa-share').addClass('none');
        $('.xa-i-rules-contentbox').addClass('none');
        $('.xa-loadingFrame').addClass('none');
        if(is_from_pay_result){
            //删除掉from=pay_result
            var link = window.location.origin + '/m/apps/group/m_group/?webapp_owner_id='+W.webappOwnerId+'&id='+W.appRecordId+'&fid='+page_owner_member_id+'&group_relation_id='+group_relation_id;
            window.location.href = link;
//            window.location.href = "?"+DelQueryString("from");
        }
    });
    $('.xa-colseButton').click(function(){
        $('.xa-share').addClass('none');
        mask('hide');
    });

    // 活动规则
    $('.xa-i-rules-title-content p').click(function(){
        $('.xa-i-rules-contentbox').removeClass('none');
        mask('show');
        $('.xa-i-closebtn').click(function(){
            $('.xa-i-rules-contentbox').addClass('none');
            mask('hide');
        });
    });

    // 邀请好友参团
    function openGuideMask(){
        mask('show');
        $('.xa-share').removeClass('none');
    }
    //开团时间不足提示
    function openRemainOneDayWin(){
        mask('show');
        $('.xui-groupMsg').removeClass('none');
        $('.xa-groupMsg').find('.xa-groupMsg-xui-i-msg-title').html('开团提示');
        $('.xa-groupMsg').find('.xa-i-msg').html('本次团购剩余时间不足1天，是否继续开团？');
        $('.wa-i-btn-groupMsg-yes,.wa-i-btn-groupMsg-no').click(function(){
            mask('hide');
            $('.xui-groupMsg').addClass('none');
        });
    }
    // 未关注引导
    function openGuestMask(){
        mask('show');
        $('.xa-attention-guest').removeClass('none');
    }
    // 支付未完成
    function openUnpaidWin(){
        mask('show');
        $('.xui-groupMsg').removeClass('none');
        if(is_self_page){
            $('.xa-groupMsg').find('.xa-i-msg').html('开团支付未完成，是否继续？');
        }else{
            $('.xa-groupMsg').find('.xa-i-msg').html('参团支付未完成，是否继续？');
        }
        $('.wa-i-btn-groupMsg-yes').click(function(){
            mask('hide');
            $('.xui-groupMsg').addClass('none');
            if(order_id != ''){
                var data_href = "http://"+settings_domain+"/mall/order_detail/?woid="+W.webappOwnerId+"&order_id="+order_id;
                window.location.href = data_href;
            }else{
                var data_href = "http://"+settings_domain+"/mall/purchasing/?woid="+W.webappOwnerId+"&product_ids="+product_id+"&product_counts=1&product_model_names=standard&group_id="+group_relation_id+"&activity_id="+W.appRecordId;
                window.location.href = data_href;
            }

        });
        $('.wa-i-btn-groupMsg-no').click(function(){
            W.getApi().call({
                app: 'm/apps/group',
                resource: 'cancel_unpaid_group',
                method: 'put',
                args: {
                    webapp_owner_id: W.webappOwnerId,
                    group_relation_id: group_relation_id,
                    member_id: W.member_id,
                    order_id: order_id
                },
                success: function(data){
                    mask('hide');
                    $('.xui-groupMsg').addClass('none');
                    window.location.href = window.location.origin + '/m/apps/group/m_group/?webapp_owner_id='+W.webappOwnerId+'&id='+W.appRecordId;
                },
                error: function(data) {
                    wuiAlert(data.errMsg);
                }
            });
        });
    }
    //成功支付
    function showSuccessPaidWin(){
        mask('show');
        $('.xui-groupMsg-payHint').removeClass('none');
        if(is_group_leader){
            $('.xa-groupMsg-payHint').find('.xa-i-msg-title').html('恭喜您 ');
            $('.xa-groupMsg-payHint').find('.xa-i-msg-title-status').html('开团成功');
            $('.xa-groupMsg-payHint').find('.xa-i-msg').html('赶紧邀请好友参团吧!');
        }else{
            $('.xa-groupMsg-payHint').find('.xa-i-msg-title').html('恭喜您 ');
            $('.xa-groupMsg-payHint').find('.xa-i-msg-title-status').html('参团成功');
            if(W.isMember){
                $('.xa-groupMsg-payHint').find('.xa-i-msg').html('赶快去邀请好友吧!');
            }else{
                $('.xa-groupMsg-payHint').find('.xa-i-msg').html('赶快去邀请好友吧!');
                $('.xa-groupMsg-payHint').find('.xa-i-msg-not-meber').html('关注后，请在个人中心查看购买商品的发货信息!');
            }
        }
    }
    //团购成功
    function showGroupSuccess(){
        mask('show');
        $('.wui-i-group_box_success').removeClass('none');
        $('.xui-groupMsg-Hint').removeClass('none');
        $('.xa-groupMsg-Hint').find('.xa-i-msg').html('商家将在该商品团购结束20天内进行发货');
        $('.xa-groupMsg-Hint').find('.xa-i-msg-title').html('恭喜您 ');
        $('.xa-groupMsg-Hint').find('.xa-i-msg-title-status').html('团购成功');
        $('.wa-i-btn-groupMsg-yes').click(function(){
            mask('hide');
            $('.xui-groupMsg-Hint').addClass('none');
        });
    }
    //团购失败
    function showGroupFailure(){
        mask('show');
        $('.wui-i-group_box_fail').removeClass('none');
        $('.wui-i-inner_bar').addClass('wui-i-inner_bar_fail');
        $('.xui-groupMsg-Hint').removeClass('none');
        $('.xa-groupMsg-Hint').find('.xa-i-msg').html('商家将在5~7个工作日内完成退款');
        $('.xa-groupMsg-Hint').find('.xa-i-msg-title').html('很遗憾 团购失败');
        $('.wa-i-btn-groupMsg-yes').click(function(){
            mask('hide');
            $('.xui-groupMsg-Hint').addClass('none');
        });
    }
    function renderTime(seconds){
        seconds = parseInt(seconds);
        var formatTime = function(data){
            data = parseInt(data);
            if(data<10){
                return '0'+data;
            }
            return data;
        };
        var $s = $('.xa-second');
        var $m = $('.xa-minute');
        var $h = $('.xa-hour');
        var $d = $('.xa-day');
        var timer = window.setInterval(function(){
            if(seconds <= 0){
                window.clearInterval(timer);
                return false;
            }
            var left_seconds = formatTime(seconds%60);
            var left_minites = formatTime(seconds/60%60);
            var left_hours = formatTime(seconds/60/60%24);
            var left_days = formatTime(seconds/60/60/24);
            $s.text(left_seconds);
            $m.text(left_minites);
            $h.text(left_hours);
            $d.text(left_days);
            seconds--;
        },990);
    }

    // 进度条
    function runProcessBar(current,total){
        $('.wui-i-choose_group_box').addClass('none');
        $('.wui-i-group_box_progress').removeClass('none');
        var current_number = current;
        var total_number = total;
        var process = "0%";
        process = parseFloat(current_number/total_number*100).toFixed(1)+"%";
        if(process=="100.0%"){
            process="100%";
        }else if(process=="0.0%"){
            process="0%";
        }
        $('.wui-i-cur_number').text(current_number+'人');
        $('.wa-i-total_number').text(total_number+'人');
        $(".xa-i-bar_process").width(process);
        percentBox_process_tmp = process;
//        percentBoxTimer();
    }

    //已参团的列表
    function showHelperInfo(data){
        var helpers_info = data.helpers_info;
        if ($.isEmptyObject(helpers_info)){
            $('.wui-i-states').addClass('none');
        }else{
            if(helpers_info || $.isEmptyObject(helpers_info)){
                $('.wui-i-states').removeClass('none');
                var li_content = '';
                for(var i in helpers_info){
                    var p = helpers_info[i];
                    if(p.user_icon!=''){
                        li_content += "<li class='wui-i-member'><img src='"+ p.user_icon+"'></li>";
                    }else{
                       li_content += "<li class='wui-i-member'><img src='/termite_static/img/component/group/defalut_icon.jpg'></li>";
                    }
                }
                for(var i=0; i < (parseInt(group_type)-helpers_info.length);i++){
                    li_content += "<li class='wui-i-member'><img src='/termite_static/img/component/group/user_icon.png'></li>";
                }
                $('.wa-grouped-members').append($(li_content));
            }
        }
    }

    function getProductDetails(){
        W.getApi().call({
            app: 'm/apps/group',
            resource: 'get_product_detail',
            method: 'get',
            args: {
                webapp_owner_id: W.webappOwnerId,
                product_id: product_id
            },
            success: function(data){
                var product_detail = data.product_detail;
                if(product_detail !=''){
                    $('.xa-productDetail-content').html(product_detail);
                }else{
                    $('.xa-productDetail-content').html("暂无商品介绍");
                }

            },
            error: function(data) {
                $('.xa-productDetail-content').html("暂无商品介绍");
            }
        });

    }
    function showProductDetails(){
        $('.wui-i-product-description-title').addClass('none');
        $('.xui-productDetail-content').removeClass('none');
    }
</script>
{% endblock %}

