{% extends "webapp_content_base_v4.html" %}

{% block css %}
<style type="text/css">
	h1 {
		color: #00F;
	}
	.xui-record {
		margin: 10px 15px;
		padding: 5px;
		box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
		border-radius: 5px;
	}
	.xui-record .xui-inner-content {
		color: #8F8F8F;
	}
	a.xui-button {
		padding: 10px;
		display: block;
		text-align: center;
		color: #FFF;
		margin: 10px 15px;
		background-color: rgba(0, 125, 255, 0.5);
		border-radius: 10px;
	}
</style>
{% endblock %}

{% block content-panel %}
    {{ page_html_content|safe }}
{% endblock %}

{% block js %}
<script type="text/javascript">
    var participances = {% if participances_list %} {{ participances_list }} {% else %}false{% endif %};

    $(function(){
        //隐藏参与活动按钮
        $('.xa-submitButtonContainer').hide();
        if(W.isPC){
            return false;
        }

        //展示参与统计
        showTop100();

        //检查活动状态
        if('进行中' != W.activityStatus){
            $('.wa-timing').hide();
            if('未开始' == W.activityStatus){
                $('.wa-notready').show();
            }else{
                $('.wa-wa-closed').show();
            }
            return false;
        }

        //启动倒计时
        renderTime({{ timing }});


    });

    function showTop100(){
        if(participances){
            var li_content = '';
            for(var i in participances){
                var p = participances[i];
                li_content += "<li><span>"+(i+1)+"</span><span><img src='"+ p.user_icon+"'>"+ p.username+"</span><span>"+ p.power+"</span>";
            }
            $('.wa-top100').append($(li_content));
        }
    }

    function renderTime(seconds){
        seconds = parseInt(seconds);
        var timer = window.setInterval(function(){
            if(seconds <= 0){
                window.clearInterval(timer);
                return false;
            }
            var left_seconds = seconds%60;
            var left_minites = seconds/60%60;
            var left_hours = seconds/60/60%24;
            var left_days = seconds/60/60/24;

            seconds--;
        },900);
    }
</script>
{% endblock %}

