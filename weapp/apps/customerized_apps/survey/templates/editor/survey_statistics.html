{% extends "content_base_v2.html" %}

{% block css %}
    <style>
        .table >thead tr, .table >tbody tr{
            border-bottom: 1px solid #eee;
        }
        .table>tbody tr th:nth-child(1){
            text-align: left;
            padding-left: 30px;
            max-width: 25%;
        }
        .table>tbody tr th:nth-child(2){
            text-align: left;
            max-width: 680px;
            min-width: 480px;
        }
        .table>tbody tr th:nth-child(3), .table>tbody tr th:nth-child(4){
            width: 100px;
        }
        .table thead > tr:nth-child(1){
            background: #fff;
        }
        .table tbody > tr:nth-child(odd) {
            background: #fff;
        }
        .table tbody > tr:nth-child(even) {
            background: #fff;
        }
        .xui-progressBar{
            position: relative;
            background: #66ABF6;
            vertical-align: middle;
            height: 21px;
            border-radius: 3px;
        }
        span{
            display: inline-block;
        }
        .xui-i-totalcount{
            margin: 7px;
        }
        .xui-i-tableHeader{
            font-family: sans-serif;
            color: #666666;
            font-weight: 600;
            background: #C8D1E4;
            width: 98%;
            margin-left: 10px;
            padding: 15px;
        }
        .xui-advancedTablePaginator {
            background: #F6F6F6;
            margin: -10px 10px -5px 10px;
            padding-bottom: 5px;

        }
        .xui-appPage-commonStyle .xui-paginationPosition{
            position: relative;
        }
        .xb-pagination-component {
            height: 33px;
        }
    </style>
{% endblock %}

{% block content-panel %}
<div class="xui-voteParticipanceFormPage xui-appPage-commonStyle">
	<ul class="breadcrumb" style="margin-bottom:-12px;">
		<li>您当前所在位置</li>
		<li><a href="/apps/lottery/lotteries/">百宝箱</a></li>
		<li><a href="/apps/survey/surveies/">用户调研</a></li>
		<li class="active">查看统计</li>
	</ul>
	
    <div class="panel panel-default xui-tableBox">
        <div class="panel-header clearfix">
            <b class="xui-i-totalcount fr">总参与人数: {{ total_count }} 人</b>
            <a class="btn btn-default xui-fontBold fr xui-i-exportBtn xa-i-exportBtn" href="javascript:void(0);">批量导出</a>
            <a id="export_href" style="display: none ">DownloadXLS</a>
        </div>
        {% for title in titles %}
            <div class="xui-i-tableHeader">
                <span>{{ forloop.counter }}、{{ title.title }}（{{ title.title_type }}）</span>
                <span class="fr">有效参与人数:{{ title.count }} 人</span>
            </div>
            {% ifequal title.type 'appkit.selection' %}
                <table class="table table-bordered xb-stripedTable xb-noTdBorder xb-noBottom xb-noBorder mb10">
                    <thead>
                        <tr style="color: #888888">
                            <td>选项</td>
                            <td></td>
                            <td>参与人数</td>
                            <td>百分比</td>
                        </tr>
                    </thead>
                    <tbody>
                        {% for v in title.values %}
                            <tr>
                                <th>{{ v.name }} </th>
                                <th>
                                    <span style="background: #EEEEEE; width: 100%"><span class="xui-progressBar" style="width: {% ifequal v.per '0' %}0{% else %}{{ v.per }}{% endifequal %}"></span></span>
                                </th>
                                <th>{{ v.count }}</th>
                                <th>{{ v.per }}</th>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div
                    class="panel-body panel-table p0"
                    data-ui-role="advanced-table"
                    data-app="apps/survey"
                    data-resource="question"
                    data-args='{"id": "{{survey_id}}","question_title":"{{title.title_}}"}'
                    data-template-id="#question_table"
                    data-enable-paginator="true"
                    data-enable-sort="false"
                    data-selectable="false"
                    data-disable-header-select="true"
                    data-item-count-per-page="10">
                </div>
            {% endifequal %}
        {% endfor %}
    </div>

</div>
{% endblock %}
{% block js %}
{% verbatim %}
    <script id="question_table" type="text/x-jquery-tmpl">
        <table id="question_value" class="table table-bordered xb-stripedTable xb-noTdBorder xb-noBottom xb-noBorder mb10">
            <thead>
                <tr style="color: #888888;">
                    <td style="text-align:left;padding-left: 30px;">答案内容</td>
                    <td style="width:20%">提交时间</td>
                </tr>
            </thead>
            <tbody>
                {{each(i, item) items}}
                    <tr>
                        <td style="text-align:left;padding-left: 30px;"><div style="width:100%;word-break:break-all; overflow:auto;">${ item.content }</div></td>
                        <td>${ item.created_at }</td>
                    </tr>
                {{/each}}
            </tbody>
        </table>
    </script>
{% endverbatim %}
    <script>
    //export
    $('.xa-i-exportBtn').click(function(event){
        W.getLoadingView();
        var export_id =window.location.search.split('?id=')[1];
        W.getApi().call({
            method: 'get',
            app: 'apps/survey',
            resource: 'survey_statistics-export',
            args: {'export_id':export_id},
            success: function(resp){
                if(resp.code == 200){
                    $('#export_href').prop({
                        'href': resp.download_path,
                        'download': resp.filename
                    }).get(0).click();

                }
                console.log("导出成功");
            },
            error: function(error){
                console.log('导出失败');
            }
        });
    });
    </script>
{% endblock %}